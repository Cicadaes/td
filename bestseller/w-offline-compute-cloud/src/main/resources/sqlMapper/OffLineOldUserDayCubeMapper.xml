<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="OffLineOldUserDayCubeMapper">

    <insert id="insert" parameterType="java.util.List">
        INSERT INTO offline_old_user_cube
        (
        tenant_id,
        project_id,
        date,
        data_type,
        bitmap
        ) VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.tenant_id},
            #{item.project_id},
            #{item.date},
            #{item.data_type},
            #{item.bitmap}
            )
        </foreach>
        ON DUPLICATE KEY UPDATE bitmap = VALUES(bitmap)
    </insert>


    <select id="query" parameterType="map"
            resultType="com.talkingdata.wifianalytics.offline.compute.bean.OffLineBitmapDayCube">
        SELECT * FROM offline_old_user_cube WHERE
        <if test="tenant_id != null">
            tenant_id = #{tenant_id} AND
        </if>
        <if test="project_id != null">
            project_id = #{project_id} AND
        </if>
        date = #{date} AND data_type = #{data_type}
    </select>
</mapper>