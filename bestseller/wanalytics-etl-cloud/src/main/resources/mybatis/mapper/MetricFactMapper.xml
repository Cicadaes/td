<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--suppress ALL -->
<mapper namespace="td.enterprise.dao.MetricFactDao">
    <!-- Result Map-->
    <resultMap id="BaseResultMap" type="td.enterprise.entity.MetricFact">
        <result column="id" property="id"/>
        <result column="brand" property="brand"/>
        <result column="region" property="region"/>
        <result column="city" property="city"/>
        <result column="province" property="province"/>
        <result column="channel" property="channel"/>
        <result column="mall" property="mall"/>
        <result column="project_name" property="projectName"/>
        <result column="project_type" property="projectType"/>
        <result column="project_id" property="projectId"/>
        <result column="date" property="date"/>
        <result column="hour" property="hour"/>
        <result column="hour_users" property="hourUsers"/>
        <result column="end_hour_users" property="endHourUsers"/>
        <result column="update_time" property="updateTime"/>
        <result column="project_num" property="projectNum"/>
        <result column="logical_city" property="logicalCity"/>
        <result column="tenant_id" property="tenantId"/>
    </resultMap>

    <!-- TD_METRIC_FACT table all fields -->
    <sql id="Base_Column_List">
	 id,brand,region,city,province,channel,mall,project_name,project_type,project_id,date,hour,hour_users,end_hour_users,update_time,project_num,logical_city,tenant_id
  </sql>

    <!-- 查询条件 -->
    <sql id="Base_Where_Clause">
        where 1=1
        <trim suffixOverrides=",">
            <if test="id != null and id != ''">
                and id = #{id}
            </if>
            <if test="brand != null and brand != ''">
                and brand = #{brand}
            </if>
            <if test="region != null and region != ''">
                and region = #{region}
            </if>
            <if test="city != null and city != ''">
                and city = #{city}
            </if>
            <if test="province != null and province != ''">
                and province = #{province}
            </if>
            <if test="channel != null and channel != ''">
                and channel = #{channel}
            </if>
            <if test="mall != null and mall != ''">
                and mall = #{mall}
            </if>
            <if test="projectName != null and projectName != ''">
                and project_name = #{projectName}
            </if>
            <if test="projectType != null and projectType != ''">
                and project_type = #{projectType}
            </if>
            <if test="projectId != null and projectId != ''">
                and project_id = #{projectId}
            </if>
            <if test="date != null and date != ''">
                and date = #{date}
            </if>
            <if test="hour != null and hour != ''">
                and hour = #{hour}
            </if>
            <if test="hourUsers != null and hourUsers != ''">
                and hour_users = #{hourUsers}
            </if>
            <if test="endHourUsers != null and endHourUsers != ''">
                and end_hour_users = #{endHourUsers}
            </if>
            <if test="updateTime != null and updateTime != ''">
                and update_time = #{updateTime}
            </if>
            <if test="projectNum != null and projectNum != ''">
                and project_num = #{projectNum}
            </if>
            <if test="logicalCity != null and logicalCity != ''">
                and logical_city = #{logicalCity}
            </if>
            <if test="tenantId != null and tenantId != ''" >
                and tenant_id =  #{tenantId}
            </if>
        </trim>
    </sql>

    <!-- 插入记录 -->
    <insert id="insert" parameterType="Object">
        <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into
        TD_METRIC_FACT(id,brand,region,city,province,channel,mall,
        project_name,project_type,project_id,date,
        hour,hour_users,end_hour_users,update_time,tenant_id)
        values(#{id},#{brand},#{region},#{city},#{province},#{channel},#{mall},
        #{projectName},#{projectType},#{projectId},#{date},
        #{hour},#{hourUsers},#{endHourUsers},now(),#{tenantId})
        ON DUPLICATE KEY UPDATE hour_users = #{hourUsers}, end_hour_users = #{endHourUsers}
    </insert>

    <!-- 根据id，修改记录-->
    <update id="updateByPrimaryKey" parameterType="Object">
      update TD_METRIC_FACT set brand=#{brand},region=#{region},city=#{city},province=#{province},channel=#{channel},mall=#{mall},project_name=#{projectName},project_type=#{projectType},project_id=#{projectId},date=#{date},hour=#{hour},hour_users=#{hourUsers},end_hour_users=#{endHourUsers},update_time=now() where id=#{id}
  </update>

    <!-- 修改记录，只修改只不为空的字段 -->
    <update id="updateByPrimaryKeySelective" parameterType="Object">
        update TD_METRIC_FACT set
        <if test="brand != null  ">
            brand=#{brand},
        </if>
        <if test="region != null  ">
            region=#{region},
        </if>
        <if test="city != null  ">
            city=#{city},
        </if>
        <if test="province != null  ">
            province=#{province},
        </if>
        <if test="channel != null  ">
            channel=#{channel},
        </if>
        <if test="mall != null  ">
            mall=#{mall},
        </if>
        <if test="projectName != null  ">
            project_name=#{projectName},
        </if>
        <if test="projectType != null  ">
            project_type=#{projectType},
        </if>
        <if test="projectId != null  ">
            project_id=#{projectId},
        </if>
        <if test="date != null  ">
            date=#{date},
        </if>
        <if test="hour != null  ">
            hour=#{hour},
        </if>
        <if test="hourUsers != null  ">
            hour_users=#{hourUsers},
        </if>
        <if test="endHourUsers != null  ">
            end_hour_users=#{endHourUsers},
        </if>
        <if test="projectNum != null  ">
            project_num=#{projectNum},
        </if>
        <if test="logicalCity != null  ">
            logical_city=#{logicalCity},
        </if>
        <if test="updateTime != null  ">
            update_time=#{updateTime},
        </if>
        update_time = now()
        where id=#{id}
    </update>

    <!-- 根据id查询 metric -->
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="Object">
        select
        <include refid="Base_Column_List"/>
        from TD_METRIC_FACT where id = #{id}
    </select>

    <!-- 删除记录 -->
    <delete id="deleteByPrimaryKey" parameterType="Object">
      delete from TD_METRIC_FACT where id = #{id}
  </delete>

    <!-- metric 列表总数-->
    <select id="queryByCount" resultType="java.lang.Integer" parameterType="Object">
        select count(1) from TD_METRIC_FACT
        <include refid="Base_Where_Clause"/>
    </select>

    <!-- 查询metric列表 -->
    <select id="queryByList" resultMap="BaseResultMap" parameterType="Object">
        select
        <include refid="Base_Column_List"/>
        from TD_METRIC_FACT
        <include refid="Base_Where_Clause"/>
        <if test="pager.orderCondition != null and pager.orderCondition != ''">
            ${pager.orderCondition}
        </if>
        <if test="pager.mysqlQueryCondition != null and pager.mysqlQueryCondition != ''">
            ${pager.mysqlQueryCondition}
        </if>
    </select>

    <!-- 根据project_id列表，date，hour 查询metric列表 -->
    <select id="queryByProjectIdList" resultMap="BaseResultMap" parameterType="Object">
        SELECT
        <include refid="Base_Column_List"/>
        FROM TD_METRIC_FACT
        <include refid="Base_Where_Clause"/>
        <if test="projectIdList != null and projectIdList.size() != 0">
            AND project_id IN
            <foreach item="item" index="index" collection="projectIdList" open="(" separator=","
                     close=")">
                #{item}
            </foreach>
        </if>
    </select>
</mapper>   
